name: Azure Static Web Apps CI-CD

pr:
  branches:
    include:
      - main
trigger:
  branches:
    include:
      - main

jobs:
- job: build_and_deploy_job
  displayName: Build and Deploy Job
  condition: or(eq(variables['Build.Reason'], 'Manual'),or(eq(variables['Build.Reason'], 'PullRequest'),eq(variables['Build.Reason'], 'IndividualCI')))
  pool:
    vmImage: ubuntu-latest
  variables:
  - group: Azure-Static-Web-Apps-purple-sand-06148da0f-variable-group
  steps:
  - checkout: self
    submodules: true

  # Ensure Node.js 20 is available for any script tasks
  - task: NodeTool@0
    inputs:
      versionSpec: '20.x'
    displayName: 'Use Node.js 20.x'

  # Build & deploy with Azure Static Web Apps
  - task: AzureStaticWebApp@0
    inputs:
      azure_static_web_apps_api_token: $(AZURE_STATIC_WEB_APPS_API_TOKEN_PURPLE_SAND_06148DA0F)
      app_location: "capgemini-hospitality"        # frontend
      api_location: ""                             # no API - using external Functions App
      output_location: "out"                       # frontend build output
    
